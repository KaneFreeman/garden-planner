name: Deploy
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
jobs:
  setup_meteor:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Decrypt large secret
        run: ./.github/scripts/decrypt.sh
        env:
          PASS: ${{ secrets.PASS }}
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Meteor
        uses: meteorengineer/setup-meteor@v1
        with:
          meteor-release: '2.6.1'
      - run: meteor npm install
      - name: Meteor Deploy
        run: DEPLOY_HOSTNAME=us-east-1.galaxy-deploy.meteor.com METEOR_SESSION_FILE=$HOME/secrets/token.json meteor deploy--settings $HOME/secrets/settings.json garden-planner.meteorapp.com
